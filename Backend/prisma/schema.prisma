// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Faculty model - represents academic faculties
model Faculty {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  courses   Course[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("faculties")
}

// Course model - represents university courses
model Course {
  id          Int          @id @default(autoincrement())
  code        String       @unique
  name        String
  yearOfStudy String
  facultyId   Int
  lecturerId  Int?
  faculty     Faculty      @relation(fields: [facultyId], references: [id], onDelete: Cascade)
  lecturer    Lecturer?    @relation(fields: [lecturerId], references: [id], onDelete: SetNull)
  assignments Assignment[]
  enrollments Enrollment[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@map("courses")
}

// Lecturer model - represents teaching staff
model Lecturer {
  id        Int      @id @default(autoincrement())
  firstName String
  lastName  String
  email     String   @unique
  password  String
  image     String   @default("avatarL.png")
  status    Int      @default(1) // 1 = active, 0 = suspended
  courses   Course[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("lecturers")
}

// Student model - represents students
model Student {
  regNo       String       @id
  firstName   String
  lastName    String
  password    String
  image       String       @default("avatarS.png")
  status      Int          @default(1) // 1 = active, 0 = suspended
  enrollments Enrollment[]
  documents   Document[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@map("students")
}

// Admin model - represents system administrators
model Admin {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  image     String   @default("avatarA.png")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

// Assignment model - represents course assignments
model Assignment {
  id             Int        @id @default(autoincrement())
  name           String
  courseId       Int
  courseName     String
  dateAssigned   DateTime   @default(now())
  submissionDate DateTime
  course         Course     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  documents      Document[]
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  @@map("assignments")
}

// Document model - represents uploaded assignment documents
model Document {
  id           Int        @id @default(autoincrement())
  name         String
  assignmentId Int
  studentRegNo String
  assignment   Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  student      Student    @relation(fields: [studentRegNo], references: [regNo], onDelete: Cascade)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@map("documents")
}

// Enrollment model - represents student course registrations
model Enrollment {
  id           Int      @id @default(autoincrement())
  courseId     Int
  studentRegNo String
  course       Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student      Student  @relation(fields: [studentRegNo], references: [regNo], onDelete: Cascade)
  createdAt    DateTime @default(now())

  @@unique([courseId, studentRegNo])
  @@map("enrollments")
}

// Comment model - represents plagiarism similarity ranges
model Comment {
  id         Int    @id @default(autoincrement())
  lowerLimit Int
  upperLimit Int
  comment    String

  @@map("comments")
}